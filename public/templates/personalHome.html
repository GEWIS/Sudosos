<div class="manage-panel-container">
    <div class="row">
        <h1 align="center">My SudoSOS</h1>
    </div>
    <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
            <h2>{{ greeting }}, {{ user.name }}!</h2>
            <h4>Your current balance is {{user.currentBalance | toEuros }}</h4>
            <h4>Your codepair is {{user.user_code}} -
                <span ng-show="!pinVisible" ng-click="pinVisible = !pinVisible">Click to reveal pin code</span>
                <span ng-show="pinVisible" ng-click="pinVisible = !pinVisible">{{ user.user_pin }}</span>
            </h4>
        </div>
    </div>
    <div class="row transactions-table">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <h2>Latest transactions</h2>
            <div cg-busy="loadingTransactions">
                <table class="table">
                    <thead>
                    <tr>
                        <th>Date</th>
                        <th>Description</th>
                        <th>Total</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody ng-repeat="transaction in transactions" ng-click="transaction.expanded = !transaction.expanded">
                    <tr>
                        <td>{{ transaction.created_at | date:'d MMM yyyy H:m'}}</td>
                        <td>{{ transaction.comment }}</td>
                        <td>{{ transaction.total_price | toEuros}}</td>
                        <td>
                            <i class="fa fa-plus-circle" aria-hidden="true" ng-hide="transaction.expanded">
                            </i>
                            <i class="fa fa-minus-circle" aria-hidden="true" ng-show="transaction.expanded">
                            </i>
                        </td>
                    </tr>
                    <tr ng-repeat="subtransaction in transaction.subtransactions" class="subtransaction-row"
                        ng-class="{'subtransaction-hidden': !transaction.expanded, 'subtransaction-visible': transaction.expanded}">
                        <td colspan="2" class="subtransaction-cell">
                            {{ subtransaction.amount }}x {{ subtransaction.product_name}} from {{ subtransaction.storage_name }}
                        </td>
                        <td colspan="2" class="subtransaction-cell">
                            {{ subtransaction.price_per_product * subtransaction.amount | toEuros}}
                        </td>
                    </tr>
                    <tr class="subtransaction-row"
                        ng-class="{'subtransaction-hidden': !transaction.expanded, 'subtransaction-visible': transaction.expanded}">
                        <td colspan="2" class="subtransaction-cell">
                            <b>Total: </b>
                        </td>
                        <td colspan="2" class="subtransaction-cell">
                            {{ transaction.total_price | toEuros}}
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div></div>
    </div>
</div>